Mario.Enemy=function(i,t,h,s,e,a){this.GroundInertia=.89,this.AirInertia=.89,this.RunTime=0,this.OnGround=!1,this.MayJump=!1,this.JumpTime=0,this.XJumpSpeed=0,this.YJumpSpeed=0,this.Width=4,this.Height=24,this.DeadTime=0,this.FlyDeath=!1,this.WingTime=0,this.NoFireballDeath=!1,this.X=t,this.Y=h,this.World=i,this.Type=e,this.Winged=a,this.Image=Enjine.Resources.Images.enemies,this.XPicO=8,this.YPicO=31,this.AvoidCliffs=this.Type===Mario.Enemy.RedKoopa,this.NoFireballDeath=this.Type===Mario.Enemy.Spiky,this.YPic=this.Type,1<this.YPic&&(this.Height=12),this.Facing=s,0===this.Facing&&(this.Facing=1),this.PicWidth=16},Mario.Enemy.prototype=new Mario.NotchSprite,Mario.Enemy.prototype.CollideCheck=function(){var i,t;0===this.DeadTime&&(i=Mario.MarioCharacter.X-this.X,t=Mario.MarioCharacter.Y-this.Y,i>2*-this.Width-4&&i<2*this.Width+4&&t>-this.Height&&t<Mario.MarioCharacter.Height&&(!(this.Type!==Mario.Enemy.Spiky&&0<Mario.MarioCharacter.Ya&&t<=0)||Mario.MarioCharacter.OnGround&&Mario.MarioCharacter.WasOnGround?Mario.MarioCharacter.GetHurt():(Mario.MarioCharacter.Stomp(this),this.Winged?(this.Winged=!1,this.Ya=0):(this.YPicO=7,this.PicHeight=8,null!==this.SpriteTemplate&&(this.SpriteTemplate.IsDead=!0),this.DeadTime=10,this.Winged=!1,this.Type===Mario.Enemy.RedKoopa?this.World.AddSprite(new Mario.Shell(this.World,this.X,this.Y,0)):this.Type===Mario.Enemy.GreenKoopa&&this.World.AddSprite(new Mario.Shell(this.World,this.X,this.Y,1))))))},Mario.Enemy.prototype.Move=function(){var i=0,t=0;if(this.WingTime++,0<this.DeadTime){if(this.DeadTime--,0===this.DeadTime){for(this.DeadTime=1,i=0;i<8;i++)this.World.AddSprite(new Mario.Sparkle(this.World,4+(this.X+16*Math.random()-8|0),4+(this.Y-8*Math.random()|0),2*Math.random()-1,-1*Math.random(),0,1,5));this.World.RemoveSprite(this)}this.FlyDeath&&(this.X+=this.Xa,this.Y+=this.Ya,this.Ya*=.95,this.Ya+=1)}else 2<this.Xa&&(this.Facing=1),this.Xa<-2&&(this.Facing=-1),this.Xa=1.75*this.Facing,this.MayJump=this.OnGround,this.XFlip=-1===this.Facing,this.RunTime+=Math.abs(this.Xa)+5,t=(this.RunTime/20|0)%2,this.OnGround||(t=1),this.SubMove(this.Xa,0)||(this.Facing=-this.Facing),this.OnGround=!1,this.SubMove(0,this.Ya),this.Ya*=this.Winged?.95:.85,this.OnGround?this.Xa*=this.GroundInertia:this.Xa*=this.AirInertia,this.OnGround?this.Winged&&(this.Ya=-10):this.Winged?this.Ya+=.6:this.Ya+=2,this.Winged&&(t=(this.WingTime/4|0)%2),this.XPic=t},Mario.Enemy.prototype.SubMove=function(i,t){for(var h=!1;8<i;){if(!this.SubMove(8,0))return!1;i-=8}for(;i<-8;){if(!this.SubMove(-8,0))return!1;i+=8}for(;8<t;){if(!this.SubMove(0,8))return!1;t-=8}for(;t<-8;){if(!this.SubMove(0,-8))return!1;t+=8}return 0<t&&(this.IsBlocking(this.X+i-this.Width,this.Y+t,i,0)||this.IsBlocking(this.X+i+this.Width,this.Y+t,i,0)||this.IsBlocking(this.X+i-this.Width,this.Y+t+1,i,t)||this.IsBlocking(this.X+i+this.Width,this.Y+t+1,i,t))&&(h=!0),t<0&&(this.IsBlocking(this.X+i,this.Y+t-this.Height,i,t)||h||this.IsBlocking(this.X+i-this.Width,this.Y+t-this.Height,i,t)||h||this.IsBlocking(this.X+i+this.Width,this.Y+t-this.Height,i,t))&&(h=!0),0<i&&(this.IsBlocking(this.X+i+this.Width,this.Y+t-this.Height,i,t)&&(h=!0),this.IsBlocking(this.X+i+this.Width,this.Y+t-(this.Height/2|0),i,t)&&(h=!0),this.IsBlocking(this.X+i+this.Width,this.Y+t,i,t)&&(h=!0),this.AvoidCliffs&&this.OnGround&&!this.World.Level.IsBlocking((this.X+this.Xa+this.Width)/16|0,this.Y/16+1|0,this.Xa,1)&&(h=!0)),i<0&&(this.IsBlocking(this.X+i-this.Width,this.Y+t-this.Height,i,t)&&(h=!0),this.IsBlocking(this.X+i-this.Width,this.Y+t-(this.Height/2|0),i,t)&&(h=!0),this.IsBlocking(this.X+i-this.Width,this.Y+t,i,t)&&(h=!0),this.AvoidCliffs&&this.OnGround&&!this.World.Level.IsBlocking((this.X+this.Xa-this.Width)/16|0,this.Y/16+1|0,this.Xa,1)&&(h=!0)),h?(i<0&&(this.X=16*((this.X-this.Width)/16|0)+this.Width,this.Xa=0),0<i&&(this.X=16*((this.X+this.Width)/16+1|0)-this.Width-1,this.Xa=0),t<0&&(this.Y=16*((this.Y-this.Height)/16|0)+this.Height,this.JumpTime=0,this.Ya=0),0<t&&(this.Y=16*((this.Y-1)/16+1|0)-1,this.OnGround=!0),!1):(this.X+=i,this.Y+=t,!0)},Mario.Enemy.prototype.IsBlocking=function(i,t,h,s){return t=t/16|0,!((i=i/16|0)===this.X/16|0&&t===this.Y/16|0)&&this.World.Level.IsBlocking(i,t,h,s)},Mario.Enemy.prototype.ShellCollideCheck=function(i){if(0!==this.DeadTime)return!1;var t=i.X-this.X,h=i.Y-this.Y;return-16<t&&t<16&&h>-this.Height&&h<i.Height&&(Enjine.Resources.PlaySound("kick"),this.Xa=2*i.Facing,this.Ya=-5,this.FlyDeath=!0,null!==this.SpriteTemplate&&(this.SpriteTemplate.IsDead=!0),this.DeadTime=100,this.Winged=!1,this.YFlip=!0)},Mario.Enemy.prototype.FireballCollideCheck=function(i){if(0!==this.DeadTime)return!1;var t=i.X-this.X,h=i.Y-this.Y;return-16<t&&t<16&&h>-this.Height&&h<i.Height?!!this.NoFireballDeath||(Enjine.Resources.PlaySound("kick"),this.Xa=2*i.Facing,this.Ya=-5,this.FlyDeath=!0,null!==this.SpriteTemplate&&(this.SpriteTemplate.IsDead=!0),this.DeadTime=100,this.Winged=!1,this.YFlip=!0):void 0},Mario.Enemy.prototype.BumpCheck=function(i,t){0===this.DeadTime&&this.X+this.Width>16*i&&this.X-this.Width<16*i+16&&t===(this.Y-1)/16|0&&(Enjine.Resources.PlaySound("kick"),this.Xa=2*-Mario.MarioCharacter.Facing,this.Ya=-5,this.FlyDeath=!0,null!==this.SpriteTemplate&&(this.SpriteTemplate.IsDead=!0),this.DeadTime=100,this.Winged=!1,this.YFlip=!0)},Mario.Enemy.prototype.SubDraw=Mario.NotchSprite.prototype.Draw,Mario.Enemy.prototype.Draw=function(i,t){var h=0,s=0;this.Winged&&(h=(this.XOld+(this.X-this.XOld)*this.Delta|0)-this.XPicO,s=(this.YOld+(this.Y-this.YOld)*this.Delta|0)-this.YPicO,this.Type!==Mario.Enemy.RedKoopa&&this.Type!==Mario.Enemy.GreenKoopa&&(this.XFlip=!this.XFlip,i.save(),i.scale(this.XFlip?-1:1,this.YFlip?-1:1),i.translate(this.XFlip?-320:0,this.YFlip?-240:0),i.drawImage(this.Image,(this.WingTime/4|0)%2*16,128,16,32,this.XFlip?320-h-24:h-8,this.YFlip?240-s-32:s-8,16,32),i.restore(),this.XFlip=!this.XFlip)),this.SubDraw(i,t),this.Winged&&(h=(this.XOld+(this.X-this.XOld)*this.Delta|0)-this.XPicO,s=(this.YOld+(this.Y-this.YOld)*this.Delta|0)-this.YPicO,this.Type===Mario.Enemy.RedKoopa&&this.Type===Mario.Enemy.GreenKoopa?(i.save(),i.scale(this.XFlip?-1:1,this.YFlip?-1:1),i.translate(this.XFlip?-320:0,this.YFlip?-240:0),i.drawImage(this.Image,(this.WingTime/4|0)%2*16,128,16,32,this.XFlip?320-h-24:h-8,this.YFlip?240-s:s-8,16,32)):(i.save(),i.scale(this.XFlip?-1:1,this.YFlip?-1:1),i.translate(this.XFlip?-320:0,this.YFlip?-240:0),i.drawImage(this.Image,(this.WingTime/4|0)%2*16,128,16,32,this.XFlip?320-h-24:h-8,this.YFlip?240-s-32:s-8,16,32)),i.restore())},Mario.Enemy.RedKoopa=0,Mario.Enemy.GreenKoopa=1,Mario.Enemy.Goomba=2,Mario.Enemy.Spiky=3,Mario.Enemy.Flower=4;