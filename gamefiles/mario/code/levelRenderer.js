Mario.LevelRenderer=function(e,i,t){this.Width=i,this.Height=t,this.Level=e,this.TilesY=1+(t/16|0),this.Delta=0,this.Tick=0,this.Bounce=0,this.AnimTime=0,this.Background=Mario.SpriteCuts.GetLevelSheet()},Mario.LevelRenderer.prototype=new Enjine.Drawable,Mario.LevelRenderer.prototype.Update=function(e){this.AnimTime+=e,this.Tick=0|this.AnimTime,this.Bounce+=30*e,this.Delta=e},Mario.LevelRenderer.prototype.Draw=function(e,i){this.DrawStatic(e,i),this.DrawDynamic(e,i)},Mario.LevelRenderer.prototype.DrawStatic=function(e,i){for(var t,h,r=0,a=0,s=i.X/16|0,o=(i.X+this.Width)/16|0,r=s;r<1+o;r++)for(a=0;a<this.TilesY;a++)t=255&this.Level.GetBlock(r,a),0==(Mario.Tile.Behaviors[t]&Mario.Tile.Animated)&&(h=this.Background[t%16][t/16|0],e.drawImage(Enjine.Resources.Images.map,h.X,h.Y,h.Width,h.Height,(r<<4)-i.X|0,a<<4|0,h.Width,h.Height))},Mario.LevelRenderer.prototype.DrawDynamic=function(e,i){for(var t,h,r=0,a=0,s=0,o=0,r=i.X/16|0;r<=(i.X+this.Width)/16|0;r++)for(a=i.Y/16|0;a<=(i.Y+this.Height)/16|0;a++)t=this.Level.GetBlock(r,a),0<(Mario.Tile.Behaviors[255&t]&Mario.Tile.Animated)&&(s=(this.Bounce/3|0)%4,0==(t%16/4|0)&&1==(t/16|0)&&3<(s=(this.Bounce/2+(r+a)/8|0)%20)&&(s=0),3==(t%16/4|0)&&0==(t/16|0)&&(s=2),(o=0)<=r&&0<=a&&r<this.Level.Width&&a<this.Level.Height&&(o=this.Level.Data[r][a]),0<o&&(o=8*Math.sin((o-this.Delta)/4*Math.PI)|0),h=this.Background[4*(t%16/4|0)+s][t/16|0],e.drawImage(Enjine.Resources.Images.map,h.X,h.Y,h.Width,h.Height,(r<<4)-i.X,(a<<4)-i.Y-o,h.Width,h.Height))},Mario.LevelRenderer.prototype.DrawExit0=function(e,i,t){for(var h,r=0,a=null,r=this.Level.ExitY-8;r<this.Level.ExitY;r++)a=this.Background[12][r===this.Level.ExitY-8?4:5],e.drawImage(Enjine.Resources.Images.map,a.X,a.Y,a.Width,a.Height,(this.Level.ExitX<<4)-i.X-16,(r<<4)-i.Y,a.Width,a.Height);t&&(h=16*this.Level.ExitY-48-3*Math.sin(this.AnimTime)*16-8,a=this.Background[12][3],e.drawImage(Enjine.Resources.Images.map,a.X,a.Y,a.Width,a.Height,(this.Level.ExitX<<4)-i.X-16,h-i.Y,a.Width,a.Height),a=this.Background[13][3],e.drawImage(Enjine.Resources.Images.map,a.X,a.Y,a.Width,a.Height,(this.Level.ExitX<<4)-i.X,h-i.Y,a.Width,a.Height))},Mario.LevelRenderer.prototype.DrawExit1=function(e,i){for(var t,h=0,h=this.Level.ExitY-8;h<this.Level.ExitY;h++)t=this.Background[13][h===this.Level.ExitY-8?4:5],e.drawImage(Enjine.Resources.Images.map,t.X,t.Y,t.Width,t.Height,(this.Level.ExitX<<4)-i.X+16,(h<<4)-i.Y,t.Width,t.Height)};