Mario.Shell=function(i,t,h,s){this.World=i,this.X=t,this.Y=h,this.YPic=s,this.Image=Enjine.Resources.Images.enemies,this.XPicO=8,this.YPicO=31,this.Width=4,this.Height=12,this.Facing=0,this.PicWidth=16,this.XPic=4,this.Ya=-5,this.Dead=!1,this.DeadTime=0,this.Carried=!1,this.GroundInertia=.89,this.AirInertia=.89,this.OnGround=!1,this.Anim=0},Mario.Shell.prototype=new Mario.NotchSprite,Mario.Shell.prototype.FireballCollideCheck=function(i){if(0!==this.DeadTime)return!1;var t=i.X-this.X,h=i.Y-this.Y;return-16<t&&t<16&&h>-this.Height&&h<i.Height&&(0!==this.Facing||(Enjine.Resources.PlaySound("kick"),this.Xa=2*i.Facing,this.Ya=-5,null!==this.SpriteTemplate&&(this.SpriteTemplate.IsDead=!0),this.DeadTime=100,this.YFlip=!0))},Mario.Shell.prototype.CollideCheck=function(){var i,t;this.Carried||this.Dead||0<this.DeadTime||(i=Mario.MarioCharacter.X-this.X,t=Mario.MarioCharacter.Y-this.Y,-16<i&&i<16&&t>-this.Height&&t<Mario.MarioCharacter.Height&&(!(0<Mario.MarioCharacter.Ya&&t<=0)||Mario.MarioCharacter.OnGround&&Mario.MarioCharacter.WasOnGround?0!==this.Facing?Mario.MarioCharacter.GetHurt():(Mario.MarioCharacter.Kick(this),this.Facing=Mario.MarioCharacter.Facing):(Mario.MarioCharacter.Stomp(this),0!==this.Facing?(this.Xa=0,this.Facing=0):this.Facing=Mario.MarioCharacter.Facing)))},Mario.Shell.prototype.Move=function(){var i=0;if(this.Carried)this.World.CheckShellCollide(this);else{if(0<this.DeadTime){if(this.DeadTime--,0===this.DeadTime){for(this.DeadTime=1,i=0;i<8;i++)this.World.AddSprite(new Mario.Sparkle(4+(this.X+16*Math.random()-8|0),4+(this.Y+8*Math.random()|0),2*Math.random()-1,-1*Math.random(),0,1,5));this.World.RemoveSprite(this)}return this.X+=this.Xa,this.Y+=this.Ya,this.Ya*=.95,void(this.Ya+=1)}0!==this.Facing&&this.Anim++,2<this.Xa&&(this.Facing=1),this.Xa<-2&&(this.Facing=-1),this.Xa=11*this.Facing,0!==this.Facing&&this.World.CheckShellCollide(this),this.XFlip=-1===this.Facing,this.XPic=(this.Anim/2|0)%4+3,this.SubMove(this.Xa,0)||(Enjine.Resources.PlaySound("bump"),this.Facing=-this.Facing),this.OnGround=!1,this.SubMove(0,this.Ya),this.Ya*=.85,this.OnGround?this.Xa*=this.GroundInertia:this.Xa*=this.AirInertia,this.OnGround||(this.Ya+=2)}},Mario.Shell.prototype.SubMove=function(i,t){for(var h=!1;8<i;){if(!this.SubMove(8,0))return!1;i-=8}for(;i<-8;){if(!this.SubMove(-8,0))return!1;i+=8}for(;8<t;){if(!this.SubMove(0,8))return!1;t-=8}for(;t<-8;){if(!this.SubMove(0,-8))return!1;t+=8}return 0<t&&(this.IsBlocking(this.X+i-this.Width,this.Y+t,i,0)||this.IsBlocking(this.X+i+this.Width,this.Y+t,i,0)||this.IsBlocking(this.X+i-this.Width,this.Y+t+1,i,t)||this.IsBlocking(this.X+i+this.Width,this.Y+t+1,i,t))&&(h=!0),t<0&&(this.IsBlocking(this.X+i,this.Y+t-this.Height,i,t)||h||this.IsBlocking(this.X+i-this.Width,this.Y+t-this.Height,i,t)||h||this.IsBlocking(this.X+i+this.Width,this.Y+t-this.Height,i,t))&&(h=!0),0<i&&(this.IsBlocking(this.X+i+this.Width,this.Y+t-this.Height,i,t)&&(h=!0),this.IsBlocking(this.X+i+this.Width,this.Y+t-(this.Height/2|0),i,t)&&(h=!0),this.IsBlocking(this.X+i+this.Width,this.Y+t,i,t)&&(h=!0)),i<0&&(this.IsBlocking(this.X+i-this.Width,this.Y+t-this.Height,i,t)&&(h=!0),this.IsBlocking(this.X+i-this.Width,this.Y+t-(this.Height/2|0),i,t)&&(h=!0),this.IsBlocking(this.X+i-this.Width,this.Y+t,i,t)&&(h=!0)),h?(i<0&&(this.X=16*((this.X-this.Width)/16|0)+this.Width,this.Xa=0),0<i&&(this.X=16*((this.X+this.Width)/16+1|0)-this.Width-1,this.Xa=0),t<0&&(this.Y=16*((this.Y-this.Height)/16|0)+this.Height,this.Ya=0),0<t&&(this.Y=16*((this.Y-1)/16+1|0)-1,this.OnGround=!0),!1):(this.X+=i,this.Y+=t,!0)},Mario.Shell.prototype.IsBlocking=function(i,t,h,s){if(t=t/16|0,(i=i/16|0)===(this.X/16|0)&&t===(this.Y/16|0))return!1;var a=this.World.Level.IsBlocking(i,t,h,s);return a&&0===s&&0!==h&&this.World.Bump(i,t,!0),a},Mario.Shell.prototype.BumpCheck=function(i,t){this.X+this.Width>16*i&&this.X-this.Width<16*i+16&&t===((this.Y-1)/16|0)&&(this.Facing=-Mario.MarioCharacter.Facing,this.Ya=-10)},Mario.Shell.prototype.Die=function(){this.Dead=!0,this.Carried=!1,this.Xa=2*-this.Facing,this.Ya=-5,this.DeadTime=100},Mario.Shell.prototype.ShellCollideCheck=function(i){if(0!==this.DeadTime)return!1;var t=i.X-this.X,h=i.Y-this.Y;return-16<t&&t<16&&h>-this.Height&&h<i.Height&&(Enjine.Resources.PlaySound("kick"),Mario.MarioCharacter.Carried!==i&&Mario.MarioCharacter.Carried!==this||(Mario.MarioCharacter.Carried=null),this.Die(),i.Die(),!0)},Mario.Shell.prototype.Release=function(i){this.Carried=!1,this.Facing=Mario.MarioCharacter.Facing,this.X+=8*this.Facing};